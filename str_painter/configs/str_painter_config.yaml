run_name: str_painter_grpo

# When fixed_seed=false, a random seed is chosen at runtime.
fixed_seed: false
seed: 42

collab:
  # Set to 1 for single-agent.
  num_agents: 1

data:
  # Path is resolved relative to this config file.
  csv_path: ../../dataset/str_builder/one.csv
  split_ratio: 0.8
  spacing: 1
  local_z: 0

task:
  # Allowed blocks for agent1 (letters).
  block_agent1: [black_concrete]
  # Allowed blocks for agent2 (background).
  block_agent2: [white_concrete]
  # Cap accepted decisions per agent (kept for compatibility).
  max_commands: 300

prompt:
  system: |
    You are a Minecraft ASCII art assistant.
    Output ONLY the ASCII grid (no markdown, no code fences, no extra text).

  hints:
    enabled: false

  # Single-agent prompt.
  user_template: |
    Draw the uppercase string as 5x5 block letters in an ASCII grid.

    String: {text}
    Difficulty: {difficulty}

    Grid rules:
    - Output exactly 5 lines (top to bottom).
    - Each letter is a 5x5 glyph; put exactly one '.' column between letters.
    - Use 'B' for black letter blocks; use '.' for no decision.

    {hint_section_single}

  # Optional overrides used when collab.num_agents=2.
  user_template_agent1: |
    You are Agent 1 (letters). Output ONLY the ASCII grid.

    Task: Draw the uppercase string as 5x5 block letters.
    String: {text}
    Difficulty: {difficulty}

    Grid rules:
    - Output exactly 5 lines (top to bottom).
    - Each letter is a 5x5 glyph; put exactly one '.' column between letters.
    - Use 'B' for black letter blocks; use '.' for no decision.

    {hint_section_agent1}

  user_template_agent2: |
    You are Agent 2 (background). Output ONLY the ASCII grid.

    Task: Paint the background (non-letter cells) for the same 5x5 glyph layout.
    String: {text}
    Difficulty: {difficulty}

    Grid rules:
    - Output exactly 5 lines (top to bottom).
    - Each letter is a 5x5 glyph; put exactly one '.' column between letters.
    - Use 'W' for white background blocks; use '.' for no decision.
    - Do NOT paint letter cells.

    {hint_section_agent2}

external:
  # Only used when trainer.num_turns > 1.
  mode: draw_feedback
  # Include the original (turn-1) prompt after the feedback.
  original_prompt: true
  # Optionally include previous outputs verbatim (usually keep false).
  previous_response: false
  # Add extra correct hints in the cleaned feedback grid.
  hint2: true

model:
  name: Qwen/Qwen3-4B-Instruct-2507
  tokenizer_kwargs: {}
  model_kwargs:
    trust_remote_code: true
    device_map: auto
    low_cpu_mem_usage: true
    attn_implementation: sdpa
  # dtype: bf16 | fp16 | fp32 | auto
  dtype: bf16
  gradient_checkpointing: false

trainer:
  # Set by scripts (supports [jobid] placeholder).
  output_dir: TODO
  num_train_epochs: 300
  per_device_train_batch_size: 1
  learning_rate: 5e-6
  logging_steps: 20
  save_steps: 200
  num_generations: 2
  max_new_tokens: 256
  temperature: 0.2
  top_p: 0.95
  # Set >1 to enable multi-turn training with external feedback prompts.
  num_turns: 2
  # comlrl MAGRPOConfig.joint_mode: aligned (index-aligned) | cross (Cartesian product)
  joint_mode: aligned
  # normalize_advantage: true
  # epsilon_clip: 12

debug:
  # Prints an ASCII grid per reward call.
  enabled: true
  max_prints: 1000
  # If >0, print every N reward calls (in addition to max_prints cap).
  every_n_calls: 20

reward_processor:
  enabled: false
  scale_factor: 1.0
  shift: null

patches:
  generation_memory: true
  single_agent_returns: true

wandb:
  enabled: true
  project: str_painter
  entity: null
  # Set by scripts (supports [jobid] placeholder).
  output_dir: TODO

output:
  save_final_model: false
  # Set by scripts (supports [jobid] placeholder).
  save_path: TODO
